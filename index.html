<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <script src="./js/aframe-spritesheet-component.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/index.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/styles.css" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="./styles/main.css">
</head>

<body>
    <main>
       <div id="backBtn" onclick="goBack()">
  <img src="./assets/icons/back-icon.png" alt="Back">
</div>

        <div id="replayButton" class="hide">
            <img src="./assets/images/replay.png" alt="Back">
        </div>
        <div id="scanText">
            <img src="./assets/images/sample.png" alt="Scanning Image" />
          </div>
      

       <!-- BUTTONS FOR 4 VIDEOS -->
<div id="mainScreen" class="man-bg">
  <div class="btn-container">
<button class="btn" onclick="goToAnimation(1)">Start 1</button>
<button class="btn" onclick="goToAnimation(2)">Start 2</button>
<button class="btn" onclick="goToAnimation(3)">Start 3</button>
<button class="btn" onclick="goToAnimation(4)">Start 4</button>

  </div>
</div>

        <div id="deviceError">
            <p>
                AR Experience works best on mobile devices.<br>Please try the experience on a mobile device.
            </p>
        </div>

        <div id="infoText">
            <p>
            </p>
        </div>

        <div class="single-btn-container">
            <button id="treatmentsBtn" class="btn" onclick="startAnimationTreatments()">
                Treatments Available
            </button>
            <button id="testimonialsBtn" class="btn" onclick="showTestimonials()">
                Before & After Treatment
            </button>
        </div>

     

        <div id="scanning-overlay" class="hidden">
            <div class="inner">
                <img src="./assets/target/marker.jpg" alt="Marker Overlay">
                <div class="scanline"></div>
            </div>
        </div>

      

        <a-scene
            mindar-image="uiScanning: #scanning-overlay; imageTargetSrc: ./assets/target/targets.mind;filterMinCF:0.0001; filterBeta: 0.001;missTolerance: 5;warmupTolerance: 5;autoStart: false;"
            renderer="colorManagement: true, physicallyCorrectLights:true;antialias: true;" vr-mode-ui="enabled: false"
            device-orientation-permission-ui="enabled: false">

         <a-assets>
  <video id="vid1" src="./assets/video/Video1.mp4" preload="auto" loop crossorigin="anonymous" webkit-playsinline playsinline></video>
  <video id="vid2" src="./assets/video/Video2.mp4" preload="auto" loop crossorigin="anonymous" webkit-playsinline playsinline></video>
  <video id="vid3" src="./assets/video/Video3.mp4" preload="auto" loop crossorigin="anonymous" webkit-playsinline playsinline></video>
  <video id="vid4" src="./assets/video/Video4.mp4" preload="auto" loop crossorigin="anonymous" webkit-playsinline playsinline></video>
</a-assets>


            <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;"
                raycaster="near: 10; far: 10000; objects: .clickable"></a-camera>

            <a-entity id="targetImage" mindar-image-target="targetIndex: 0">

            <a-video id="displayVideo" src="#vid1" width="1.5" height="0.9" position="0 0 0" rotation="0 0 0"></a-video>


            </a-entity>

        </a-scene>
    </main>
    <script src="./js/gsap.min.js"></script>
    <script src="./js/man-ar.js"></script>
    <script src="./js/menu.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>

 <script>
  document.addEventListener("DOMContentLoaded", () => {
    const videoElements = {
      "Video1.mp4": document.querySelector("#vid1"),
      "Video2.mp4": document.querySelector("#vid2"),
      "Video3.mp4": document.querySelector("#vid3"),
      "Video4.mp4": document.querySelector("#vid4")
    };

    const aVideo = document.querySelector("#displayVideo");
    const targetEntity = document.querySelector("#targetImage");

    // Resume playback on mobile user interaction
    const resumeAllVideos = () => {
      Object.values(videoElements).forEach(v => {
        v.play().catch(() => {});
      });
      document.body.removeEventListener("click", resumeAllVideos);
    };
    document.body.addEventListener("click", resumeAllVideos);

    // Auto-play when marker is found
    targetEntity.addEventListener("targetFound", () => {
      const srcId = aVideo.getAttribute("src");
      const video = document.querySelector(srcId);
      video.play();
    });

    // Pause when marker is lost
    targetEntity.addEventListener("targetLost", () => {
      const srcId = aVideo.getAttribute("src");
      const video = document.querySelector(srcId);
      video.pause();
    });

    // Switch video logic
    window.playSelectedVideo = (videoName) => {
      // Pause all videos first
      Object.values(videoElements).forEach(v => v.pause());

      // Switch source on <a-video>
      const selectedVideoId = Object.keys(videoElements).find(key => key === videoName);
      aVideo.setAttribute("src", `#${videoElements[selectedVideoId].id}`);

      // Play it if marker is already visible
      const isVisible = targetEntity.components['mindar-image-target']?.markerVisible;
      if (isVisible) {
        videoElements[videoName].play();
      }
    };
  });
</script>


</body>

</html>